<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Koipond â€” throw a stone, watch the pond rewrite itself</title>
  <meta name="description" content="A Ruby gem that finds your most recently changed file and asks Claude to reimagine its neighbors. Built from Ruby's intrinsic qualities, in the spirit of _why.">

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Fraunces:opsz,wght@9..144,400;9..144,600&family=JetBrains+Mono:wght@400&family=Source+Serif+4:opsz,wght@8..60,400;8..60,600&display=swap" rel="stylesheet">

  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <a href="#main" class="skip-link">Skip to content</a>

  <!-- Floating koi -->
  <div class="koi-container" aria-hidden="true">
    <div class="koi">ğŸŸ</div>
    <div class="koi">ğŸŸ</div>
  </div>

  <!-- Lily pad blobs -->
  <div class="lily-pads" aria-hidden="true">
    <div class="lily-pad"></div>
    <div class="lily-pad"></div>
    <div class="lily-pad"></div>
  </div>

  <!-- Organic shoreline (bottom edge) -->
  <div class="shoreline" aria-hidden="true"></div>

  <!-- Hero -->
  <header class="hero">
    <!-- Ripples emanate from the stone -->
    <div class="ripple-container" aria-hidden="true">
      <div class="ripple"></div>
      <div class="ripple"></div>
      <div class="ripple"></div>
      <div class="ripple"></div>
      <div class="ripple"></div>
    </div>

    <!-- Tide marks (persistent ripple echoes) -->
    <div class="tide-marks" aria-hidden="true"></div>


    <h1 class="hero-title"><span class="hero-emoji">ğŸŸ</span> Koipond</h1>

    <!-- Interactive tagline with the stone as trigger -->
    <p class="hero-tagline">
      <span class="morphing-text"><span class="text-before">Throw a </span><span class="text-after" aria-hidden="true">You threw a </span></span><span class="stone-trigger" tabindex="0" role="button" aria-label="Click to throw the stone">stone</span><span class="tagline-rest"> into your pond of code.</span>
      <br>
      <span class="morphing-text tagline-line2"><span class="text-before">Watch the <span class="ripple-word">ripples</span> rewrite the shore.</span><span class="text-after" aria-hidden="true">The ripples are rewriting the shore.</span></span>
    </p>

    <p class="hero-subtitle morphing-text">
      <span class="text-before">A Ruby gem that reimagines your codebase, one change at a time.</span>
      <span class="text-after" aria-hidden="true">The pond remembers.</span>
    </p>

    <!-- Hidden quote - appears after throw 3 -->
    <p class="hidden-quote" aria-hidden="true">"the program itself is a poem" â€” _why</p>

    <!-- Surfacing koi - appears on throw 3 -->
    <div class="koi-surface" aria-hidden="true">ğŸŸ</div>
  </header>

  <main id="main" class="container">

    <!-- The Idea -->
    <section>
      <h2>The Idea</h2>
      <p><span class="morphing-text idea-opener"><span class="text-before">You change a file.</span><span class="text-after" aria-hidden="true">You changed a file.</span></span> Its neighbors should know. They should adapt, harmonize, evolve. But they just sit there â€” frozen in their last known state, drifting slowly out of tune.</p>
      <p>What if one command could ripple your change outward?</p>

      <div class="terminal">
        <div class="terminal-header">
          <span class="terminal-dot terminal-dot--red"></span>
          <span class="terminal-dot terminal-dot--yellow"></span>
          <span class="terminal-dot terminal-dot--green"></span>
        </div>
        <pre><span class="prompt">$</span> koi --poignant
<span class="emoji">ğŸŒŠ</span> <span class="output">Pond(my_project, 14 stones)</span>
<span class="output">Last touched:</span> <span class="emoji">ğŸª¨</span> <span class="output">user.rb touched=14:32:07</span>
<span class="output">Kin:</span> <span class="emoji">ğŸª¨</span> <span class="output">authentication.rb,</span> <span class="emoji">ğŸª¨</span> <span class="output">profile.rb</span>

<span class="emoji">ğŸ”®</span> <span class="output">Reflection: 2 files reimagined from</span> <span class="emoji">ğŸª¨</span> <span class="output">user.rb</span></pre>
      </div>

      <p>That's Koipond. One stone, thrown by you. Ripples carried by Claude. The pond settles into a new shape.</p>
    </section>

    <!-- Architecture -->
    <section>
      <h2>The Architecture</h2>
      <p>Koipond is built around four core concepts, each demonstrating Ruby patterns:</p>

      <div class="architecture">
        <div class="arch-item">
          <span class="arch-emoji">ğŸª¨</span>
          <div class="arch-name">Stone</div>
          <div class="arch-desc">A Ruby file that changed</div>
          <div class="arch-ruby">Struct, Comparable</div>
        </div>
        <div class="arch-item">
          <span class="arch-emoji">ğŸŒŠ</span>
          <div class="arch-name">Pond</div>
          <div class="arch-desc">Your project directory</div>
          <div class="arch-ruby">Enumerable, method_missing</div>
        </div>
        <div class="arch-item">
          <span class="arch-emoji">ã€°ï¸</span>
          <div class="arch-name">Wave</div>
          <div class="arch-desc">The ripple to Claude</div>
          <div class="arch-ruby">Lambdas as strategies</div>
        </div>
        <div class="arch-item">
          <span class="arch-emoji">ğŸ”®</span>
          <div class="arch-name">Reflection</div>
          <div class="arch-desc">What comes back</div>
          <div class="arch-ruby">tap, then, immutable</div>
        </div>
      </div>
    </section>

    <!-- A Tour of Ruby -->
    <section>
      <h2>A Tour of Ruby, Through Koipond</h2>
      <p>Every feature of Koipond exists to showcase something about Ruby. Here is the tour.</p>

      <div class="ruby-tour">

        <details>
          <summary>Refinements â€” Polite Metamorphosis</summary>
          <div class="tour-content">
            <p>Most languages lock their core types. Ruby opens them â€” and Refinements let you open them <em>politely</em>, scoped to wherever you say <code>using</code>:</p>
            <pre><code>module Koipond::StringSwims
  refine String do
    def ripple!(style: :gentle)
      to_stone.throw!(style: style)
    end
  end
end

# Later, in your code:
using Koipond::StringSwims
"app/models/user.rb".ripple!</code></pre>
            <p>The String class gains <code>.ripple!</code> only where you ask for it. Everywhere else, strings are still just strings. It is monkey-patching that learned manners.</p>
          </div>
        </details>

        <details>
          <summary>Struct â€” Ceremony-Free Objects</summary>
          <div class="tour-content">
            <p>When a full class is too much and a Hash is too little:</p>
            <pre><code>Stone = Struct.new(:path, :pond, keyword_init: true) do
  include Comparable

  def <=>(other)
    path.heartbeat <=> other.path.heartbeat
  end
end</code></pre>
            <p>One line gives you <code>initialize</code>, <code>==</code>, <code>to_a</code>, <code>members</code>, <code>[]</code>, <code>each_pair</code>, and more. Then you open the block and add only what's unique. Ruby believes you shouldn't write the same boilerplate twice.</p>
          </div>
        </details>

        <details>
          <summary>Comparable â€” Define One Method, Get Six</summary>
          <div class="tour-content">
            <p>Include <code>Comparable</code> and define <code><=></code>. Ruby gives you <code>&lt;</code>, <code>&lt;=</code>, <code>==</code>, <code>&gt;=</code>, <code>&gt;</code>, <code>between?</code>, and <code>clamp</code>. For free. Forever.</p>
            <p>Stones sort by modification time. The most recently touched file rises to the top. We wrote one method. Ruby wrote the rest.</p>
          </div>
        </details>

        <details>
          <summary>Enumerable â€” Define One Method, Get Sixty</summary>
          <div class="tour-content">
            <p>The Pond includes <code>Enumerable</code> and defines <code>each</code>. Now the Pond responds to <code>map</code>, <code>select</code>, <code>reduce</code>, <code>sort</code>, <code>min</code>, <code>max</code>, <code>flat_map</code>, <code>group_by</code>, <code>tally</code>, <code>any?</code>, <code>none?</code>, <code>count</code>, <code>take</code>, <code>zip</code>, <code>chunk</code>, <code>each_slice</code>, <code>each_cons</code>... roughly sixty methods, all from one.</p>
            <p>This is Ruby's philosophy of generosity. You do the minimum. Ruby multiplies it.</p>
          </div>
        </details>

        <details>
          <summary>method_missing â€” The Living Object</summary>
          <div class="tour-content">
            <p>When you call a method that doesn't exist, Ruby doesn't just crash. It asks the object: <em>"Do you want to handle this?"</em></p>
            <pre><code>pond = Koipond.pond
pond.user_model          # finds user_model.rb
pond.user_model.kin      # its relatives
pond.user_model.throw!   # reimagine its world</code></pre>
            <p>Three words. Reads like English. The Pond intercepts unknown method names, searches its stones, and returns the matching file. The pond <em>feels alive</em>.</p>
          </div>
        </details>

        <details>
          <summary>TracePoint â€” The Nature Documentary</summary>
          <div class="tour-content">
            <p>TracePoint lets you observe method calls as they happen â€” live, without modifying any code. Koipond uses it to narrate its own execution:</p>
            <pre><code>Koipond.narrate!

  ğŸŸ the pond remembers who moved last
  ğŸŸ reading the stone's inscription
  ğŸŸ searching for family in the water
  ğŸŸ a stone arcs through the air
  ğŸŸ whispering to Claude across the wire
  ğŸŸ ripples spreading outward</code></pre>
            <p>Most languages need AOP frameworks for this. Ruby has it built in.</p>
          </div>
        </details>

      </div>
    </section>

    <!-- In the Spirit Of -->
    <section>
      <h2>In the Spirit Of</h2>

      <div class="why-tribute">
        <blockquote>
          "when you don't create things, you become defined by your tastes rather than ability."
        </blockquote>
        <cite>â€” _why the lucky stiff</cite>
      </div>

      <p><strong>_why</strong> taught us that programming is not just engineering. It is expression. It is play. It is writing a letter to your future self, and maybe to a fox or two along the way.</p>

      <p>He gave us Camping (a web framework in 4KB), Shoes (a GUI toolkit for beginners), and Hpricot (an HTML parser that was fast and friendly). He wrote <em>Why's (Poignant) Guide to Ruby</em>, which is the only programming book that has a soundtrack.</p>

      <p>Then he disappeared. All his code, gone from the internet. Because maybe the point was never the code. Maybe the point was the feeling you got when you read it.</p>

      <p>Koipond is a small attempt to chase that feeling.</p>
    </section>

    <!-- Get Started -->
    <section>
      <div class="get-started">
        <h2>Get Started</h2>

        <div class="install-command">gem install koipond</div>

        <div class="terminal" style="text-align: left; margin-top: var(--space-md);">
          <pre><span class="prompt">$</span> koi --poignant</pre>
        </div>

        <p class="aside">Or just drop <code>lib/koipond.rb</code> anywhere. It's one file. _why would approve.</p>
      </div>
    </section>

  </main>

  <!-- Footer -->
  <footer class="container">
    <blockquote>
      "For now, put your code in a safe. Go play outside."
      <cite>â€” _why</cite>
    </blockquote>

    <div class="footer-links">
      <a href="https://github.com/ge/koipond">
        <span>View on GitHub</span>
        <span>â†’</span>
      </a>
    </div>

    <!-- Reset link - appears after throw 5 -->
    <a href="#" class="reset-link" aria-label="Reset pond to initial state">â†º reset pond</a>
  </footer>

  <!-- Stone throwing with progressive easter eggs -->
  <script>
    (function() {
      const reducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
      const stone = document.querySelector('.stone-trigger');
      const rippleContainer = document.querySelector('.ripple-container');
      const hero = document.querySelector('.hero');
      const body = document.body;
      const rippleWord = document.querySelector('.ripple-word');
      const hiddenQuote = document.querySelector('.hidden-quote');
      const koiSurface = document.querySelector('.koi-surface');
      const resetLink = document.querySelector('.reset-link');
      const whyTribute = document.querySelector('.why-tribute blockquote');
      const tideMarks = document.querySelector('.tide-marks');

      // Restore throw count from localStorage
      let throwCount = parseInt(localStorage.getItem('koipond-thrown') || '0', 10);

      // Console styling
      const logStyle = 'color: #4a7c8c; font-style: italic;';
      const log = (msg) => console.log('%c' + msg, logStyle);

      // Update aria-hidden attributes for morphing text
      const updateAriaHidden = (narrativeActive) => {
        document.querySelectorAll('.morphing-text').forEach(container => {
          const before = container.querySelector('.text-before');
          const after = container.querySelector('.text-after');
          if (before && after) {
            before.setAttribute('aria-hidden', narrativeActive ? 'true' : 'false');
            after.setAttribute('aria-hidden', narrativeActive ? 'false' : 'true');
          }
        });
      };

      // Add a tide mark ring that fades over time
      const addTideMark = (throwNum) => {
        if (!tideMarks) return;
        const mark = document.createElement('div');
        mark.className = 'tide-mark';
        mark.style.setProperty('--size', `${200 + throwNum * 40}px`);
        tideMarks.appendChild(mark);

        // Remove from DOM when fade animation completes
        mark.addEventListener('animationend', () => mark.remove());
      };

      // Apply persisted states on load
      const applyState = () => {
        if (throwCount >= 5) {
          body.classList.add('narrative-mode');
          resetLink.classList.add('visible');
          updateAriaHidden(true);
        }
        if (throwCount >= 10) {
          body.classList.add('poignant-mode');
        }
        if (throwCount >= 3) {
          hiddenQuote.classList.add('visible');
        }

        // Restore tide marks based on throw count
        for (let i = 3; i <= Math.min(throwCount, 10); i++) {
          addTideMark(i);
        }
      };

      // Reset pond to initial state
      const resetPond = (e) => {
        e.preventDefault();
        throwCount = 0;
        localStorage.removeItem('koipond-thrown');
        body.classList.remove('narrative-mode', 'poignant-mode');
        hiddenQuote.classList.remove('visible');
        resetLink.classList.remove('visible');
        updateAriaHidden(false);

        // Clear evolving layers
        if (tideMarks) tideMarks.innerHTML = '';

        log('ğŸŸ the pond forgets');
      };

      if (resetLink) {
        resetLink.addEventListener('click', resetPond);
      }

      // Apply initial state
      applyState();

      if (reducedMotion || !stone || !rippleContainer || !hero) return;

      const throwStone = () => {
        throwCount++;
        localStorage.setItem('koipond-thrown', throwCount.toString());

        // Base animation
        stone.classList.add('thrown');
        rippleContainer.classList.add('burst');
        hero.classList.add('rippling');

        // Wave the "ripples" word
        if (rippleWord) {
          rippleWord.classList.add('waving');
          setTimeout(() => rippleWord.classList.remove('waving'), 1500);
        }

        // Throw 1: Console poetry
        if (throwCount === 1) {
          log('ğŸŸ the stone sinks slowly');
          setTimeout(() => log('ğŸŸ ripples spread outward'), 500);
          setTimeout(() => log('ğŸŸ something stirs in the depths'), 1000);
        }

        // Throw 3+: Evolving layers (tide marks)
        if (throwCount >= 3) {
          addTideMark(throwCount);
        }

        // Throw 3: Koi surfaces + hidden quote
        if (throwCount === 3) {
          if (koiSurface) {
            koiSurface.classList.add('surfacing');
            setTimeout(() => koiSurface.classList.remove('surfacing'), 2000);
          }
          if (hiddenQuote) {
            hiddenQuote.classList.add('visible');
          }
        }

        // Throw 5: Narrative shift
        if (throwCount === 5) {
          body.classList.add('narrative-mode');
          if (resetLink) resetLink.classList.add('visible');
          updateAriaHidden(true);
          log('ğŸŸ the pond remembers you now');
          log('ğŸŸ');
          log('ğŸŸ "when you don\'t create things, you become');
          log('ğŸŸ  defined by your tastes rather than ability."');
          log('ğŸŸ                                    â€” _why');
        }

        // Throw 10: Poignant mode
        if (throwCount === 10) {
          body.classList.add('poignant-mode');
          if (whyTribute) {
            whyTribute.innerHTML = '"For now, put on some cartoons. You can program later."';
          }
        }

        // Reset throw animation
        setTimeout(() => {
          stone.classList.remove('thrown');
          rippleContainer.classList.remove('burst');
        }, 2500);
      };

      stone.addEventListener('click', throwStone);
      stone.addEventListener('keydown', (e) => {
        if (e.key === 'Enter' || e.key === ' ') {
          e.preventDefault();
          throwStone();
        }
      });
    })();
  </script>
</body>
</html>
